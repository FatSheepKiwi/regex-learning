# 4. 断言(正则位置匹配)

初学者很容易会被断言绕晕，什么正后行断言，零宽负先行断言等等，概念复杂的一批。其实为了更好的理解断言，我们最好还是要回归到英文语境中去。在英文中，先行断言（Lookahead）和后行断言（Lookbehind）可以统称为Lookarounds。这样就很容易理解了，就是向前看，向后看和来回看。

同时在正则的语境中，断言都属于**非捕获组（non-capturing groups）**，不捕获也就是不匹配文本，也不进行计数。所以在其他教程中，正则的断言也被称为**零宽（zero-width**）(正|负)(先|后)行断言。零宽度，就是不匹配内容的意思。在下面的教程中，我们将省略零宽字样。

明确了英文语境后，我们就有了以下的概念：

- 零宽（zero-width）：只匹配位置，在匹配过程中，不占用字符，不计数。
- 先行（lookahead）：正则引擎从左往右扫描，锚定基准是没扫描过内容，向前看。
- 后行（lookbehind）：正则引擎从左往右扫描，锚定基准是扫描过的内容，向后看，即产生回溯。后行断言也要写在要匹配内容的左边。
- 正向（positive）：匹配括号中的表达式。
- 负向（negative）：不匹配括号中的表达式。

在正则表达式中，我们使用 `?` 开始的符合来表示这是个断言； `=...` 是正向的，`!...` 是负向的，就像逻判断中的 `==...` 和 `!=...` 一样，来表示我们要不要匹配表达式；`<` 来表示后行断言，它就像是个方向箭头，告诉正则引擎，去回溯查找。

这样我们就有了断言符号：

|符号|描述|作用|
|:----:|----|----|
|?=|正先行断言|匹配|
|?!|负先行断言|不匹配|
|?<=|正后行断言|匹配|
|?<!|负后行断言|不匹配|

所以断言的使用场景就很清楚了。当我们需要匹配的格式必须在另一个确定的格式之前或者之后，我们就可以使用断言来把匹配的范围约束在确定的格式附近。

例如，有字符串 `$4.44 and $10.88` 我们想要获得所有跟在 `$` 符号后的数字，那就可以使用正后行断言 `(?<=\$)[0-9\.]*`。也就是我们要匹配数字或小数点 `{0,1,2,3,4,5,6,7,8,9,.}` ，这些字符可以出现大于等于 0 次，并且它们前面得有个`$` 开头。


## 4.1 正先行断言 `?=...` 

正先行断言 `?=...`，表示第一部分正则表达式之后必须跟着 `?=...`定义的内容，但是返回结果只包含满足匹配条件的第一部分表达式。

定义一个正先行断言要使用 `()`，在括号内部使用一个问号和等号： `(?=...)` ，正先行断言的内容写在括号中的等号后面。

例如，表达式 `(T|t)he(?=\sfat)` 匹配 `The` 和 `the`，并且在之后的括号中我们又定义了正先行断言 `(?=\sfat)` ，即 `The` 和 `the` 后面紧跟着 `(空格)fat`。

<pre>
"(T|t)he(?=\sfat)" => <a href="#"><strong>The</strong></a> fat cat sat on the mat.
</pre>

[在线练习](https://regex101.com/r/IDDARt/1)

## 4.2 负先行断言 `?!...`

同理，负先行断言 `?!...` 用于筛选所有第一部分正则表达式匹配结果，第一部分正则表达式之后不能跟着 `?!...`定义的内容。为了表示负先行断言的不匹配，我们将 `?=...` 替换成 `?!...` 。

表达式 `(T|t)he(?!\sfat)` 匹配 `The` 和 `the`，且其后不跟着 `(空格)fat`。

<pre>
"(T|t)he(?!\sfat)" => The fat cat sat on <a href="#"><strong>the</strong></a> mat.
</pre>

[在线练习](https://regex101.com/r/V32Npg/1)

## 4.3 正后行断言 `?<=...`

正后行断言 `(?<=...)` ，与先行断言相反，用于筛选第二部分正则表达式所有匹配结果，匹配结果的**前面**必须有后行断言（第一部分正则表达式）中定义的表达式。

例如，表达式 `(?<=(T|t)he\s)(fat|mat)` 匹配 `fat` 和 `mat`，要求它们前面必须要跟着 `The ` 或 `the `。

<pre>
"(?<=(T|t)he\s)(fat|mat)" => The <a href="#"><strong>fat</strong></a> cat sat on the <a href="#"><strong>mat</strong></a>.
</pre>

[在线练习](https://regex101.com/r/avH165/1)

## 4.4 负后行断言 `?<!...`

负后行断言 `(?<!)` 用于筛选第二部分正则表达式所有匹配结果，匹配结果的**前面不能**有后行断言中定义的表达式。

例如，表达式 `(?<!(T|t)he\s)(cat)` 匹配 `cat`，且其前不跟着 `The` 或 `the`。

<pre>
"(?&lt;!(T|t)he\s)(cat)" => The cat sat on <a href="#"><strong>cat</strong></a>.
</pre>

[在线练习](https://regex101.com/r/8Efx5G/1)